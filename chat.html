<!DOCTYPE html>
<html>
<head>
  <title>Campaign Chat</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
</head>
<body>
  <!-- Navigation -->
  <nav style="background:#222; padding:10px; text-align:center;">
    <a href="index.html" style="color:#ff4444; margin:0 10px;">Home</a>
    <a href="main-quest.html" style="color:#ff4444; margin:0 10px;">Main Quest</a>
    <a href="side-quests.html" style="color:#ff4444; margin:0 10px;">Side Quests</a>
    <a href="characters.html" style="color:#ff4444; margin:0 10px;">Characters</a>
    <a href="sessions.html" style="color:#ff4444; margin:0 10px;">Sessions</a>
    <a href="submit-update.html" style="color:#ff4444; margin:0 10px;">Submit Update</a>
    <a href="chat.html" style="color:#ffffff; margin:0 10px; text-decoration:underline;">Chat</a>
  </nav>

  <h2 style="color:#ff4444; text-align:center;">Live Campaign Chat</h2>

  <div id="messages" style="height: 300px; overflow-y: scroll; background: #111; color: #fff; padding: 10px; border: 1px solid #444; margin: 0 auto; width: 80%; max-width: 700px;"></div>

  <div style="margin-top: 10px; text-align: center;">
    <input type="text" id="username" placeholder="Your name" style="width: 150px;">
    <input type="text" id="message" placeholder="Type a message" style="width: 300px;">
    <button onclick="sendMessage()">Send</button>
  </div>

  <script>
    // ✅ Firebase Config from your project
    const firebaseConfig = {
      apiKey: "AIzaSyDLgfmO_JnJEJ0l2LXPxxI5iD2B2FlYfgo",
      authDomain: "chat-site-6a018.firebaseapp.com",
      projectId: "chat-site-6a018",
      storageBucket: "chat-site-6a018.firebasestorage.app",
      messagingSenderId: "868445914716",
      appId: "1:868445914716:web:bfe0937ff1dd2842ed0899",
      databaseURL: "https://chat-site-6a018-default-rtdb.firebaseio.com"
    };

    // ✅ Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref("messages");

    // ✅ Load messages in real-time
    db.on("child_added", function(snapshot) {
      const data = snapshot.val();
      const msgDiv = document.getElementById("messages");
      const time = new Date(data.timestamp).toLocaleTimeString();
      msgDiv.innerHTML += `<p><strong>[${time}] ${data.name}:</strong> ${data.text}</p>`;
      msgDiv.scrollTop = msgDiv.scrollHeight;
    });

    // ✅ Send message function
    function sendMessage() {
      const name = document.getElementById("username").value || "Anonymous";
      const text = document.getElementById("message").value.trim();
      if (text) {
        db.push({
          name: name,
          text: text,
          timestamp: Date.now()
        });
        document.getElementById("message").value = "";
        localStorage.setItem("chat-username", name);
      }
    }

    // ✅ Send on Enter key
    document.getElementById("message").addEventListener("keypress", function(e) {
      if (e.key === "Enter") sendMessage();
    });

    // ✅ Load saved username
    window.onload = () => {
      const savedName = localStorage.getItem("chat-username");
      if (savedName) document.getElementById("username").value = savedName;
    };
  </script>
</body>
</html>
