<!DOCTYPE html>
<html>
<head>
  <title>Campaign Chat</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
</head>
<body>
  <nav>
    <a href="index.html">Home</a>
    <a href="main-quest.html">Main Quest</a>
    <a href="side-quests.html">Side Quests</a>
    <a href="characters.html">Characters</a>
    <a href="sessions.html">Sessions</a>
    <a href="submit-update.html">Submit Update</a>
    <a href="chat.html">Chat</a>
  </nav>

  <h2>Live Campaign Chat</h2>

  <div id="messages" style="height: 300px; overflow-y: scroll; background: #111; color: #fff; padding: 10px; border: 1px solid #444;"></div>

  <div style="margin-top: 10px;">
    <input type="text" id="username" placeholder="Your name" style="width: 150px;">
    <input type="text" id="message" placeholder="Type a message" style="width: 300px;">
    <button onclick="sendMessage()">Send</button>
  </div>

  <script>
    // Replace this with your actual Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "your-project.firebaseapp.com",
      databaseURL: "https://your-project.firebaseio.com",
      projectId: "your-project-id",
      storageBucket: "your-project.appspot.com",
      messagingSenderId: "YOUR_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref("messages");

    // Load messages
    db.on("child_added", function(snapshot) {
      const data = snapshot.val();
      const msgDiv = document.getElementById("messages");
      const time = new Date(data.timestamp).toLocaleTimeString();
      msgDiv.innerHTML += `<p><strong>[${time}] ${data.name}:</strong> ${data.text}</p>`;
      msgDiv.scrollTop = msgDiv.scrollHeight;
    });

    // Send message
    function sendMessage() {
      const name = document.getElementById("username").value || "Anonymous";
      const text = document.getElementById("message").value.trim();
      if (text) {
        db.push({
          name: name,
          text: text,
          timestamp: Date.now()
        });
        document.getElementById("message").value = "";
      }
      localStorage.setItem("chat-username", name); // Save name
    }

    // Enter key sends message
    document.getElementById("message").addEventListener("keypress", function(e) {
      if (e.key === "Enter") sendMessage();
    });

    // Load saved name
    window.onload = () => {
      const savedName = localStorage.getItem("chat-username");
      if (savedName) document.getElementById("username").value = savedName;
    };
  </script>
</body>
</html>
